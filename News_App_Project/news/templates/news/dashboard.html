{% extends 'news/base.html' %}

{% block title %}Dashboard - NewsHub{% endblock %}

{% block content %}
<div class="page-header text-center">
    <h1><i class="bi bi-speedometer2"></i> Welcome, {{ user.get_full_name|default:user.username }}!</h1>
    <p class="lead">
        Role: <span class="badge bg-info badge-custom">{{ user.get_role_display }}</span>
    </p>
</div>

{% if user.is_editor %}
    <!-- Editor Dashboard -->
    <div class="row">
        <div class="col-md-12 mb-4">
            <div class="custom-card">
                <div class="card-body text-center">
                    <h3><i class="bi bi-clipboard-check"></i> Editor Dashboard</h3>
                    <p class="mb-4">You have <strong class="text-danger">{{ pending_count }}</strong> article(s) awaiting approval</p>
                    <a href="{% url 'pending_articles' %}" class="btn btn-primary-custom btn-custom">
                        <i class="bi bi-clock-history"></i> Review Pending Articles
                    </a>
                </div>
            </div>
        </div>
    </div>
    
    {% if recent_articles %}
        <div class="row">
            <div class="col-12">
                <div class="custom-card">
                    <div class="card-body">
                        <h3 class="mb-4"><i class="bi bi-file-earmark-text"></i> Recent Articles</h3>
                        <div class="list-group list-group-flush">
                            {% for article in recent_articles %}
                                <div class="list-group-item d-flex justify-content-between align-items-center border-0 px-0">
                                    <a href="{% url 'article_detail' article.id %}" class="text-decoration-none">{{ article.title }}</a>
                                    {% if article.approved %}
                                        <span class="badge bg-success badge-custom">
                                            <i class="bi bi-check-circle"></i> Approved
                                        </span>
                                    {% else %}
                                        <span class="badge bg-warning badge-custom">
                                            <i class="bi bi-clock"></i> Pending
                                        </span>
                                    {% endif %}
                                </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    {% endif %}

{% elif user.is_journalist %}
    <!-- Journalist Dashboard -->
    <div class="row">
        <div class="col-md-12 mb-4">
            <div class="custom-card">
                <div class="card-body text-center">
                    <h3><i class="bi bi-pencil-square"></i> Journalist Dashboard</h3>
                    <p class="mb-4">Create and manage your articles and newsletters</p>
                    <a href="{% url 'create_article' %}" class="btn btn-success btn-custom me-2">
                        <i class="bi bi-plus-circle"></i> Create New Article
                    </a>
                    <a href="{% url 'create_newsletter' %}" class="btn btn-info btn-custom">
                        <i class="bi bi-envelope-plus"></i> Create New Newsletter
                    </a>
                </div>
            </div>
        </div>
    </div>
    
    <div class="row">
        {% if my_articles %}
            <div class="col-lg-6 mb-4">
                <div class="custom-card h-100">
                    <div class="card-body">
                        <h3 class="mb-4"><i class="bi bi-file-earmark-text"></i> My Recent Articles</h3>
                        <div class="list-group list-group-flush">
                            {% for article in my_articles %}
                                <div class="list-group-item d-flex justify-content-between align-items-center border-0 px-0">
                                    <a href="{% url 'article_detail' article.id %}" class="text-decoration-none">{{ article.title }}</a>
                                    {% if article.approved %}
                                        <span class="badge bg-success badge-custom">
                                            <i class="bi bi-check-circle"></i> Approved
                                        </span>
                                    {% else %}
                                        <span class="badge bg-warning badge-custom">
                                            <i class="bi bi-clock"></i> Pending
                                        </span>
                                    {% endif %}
                                </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
            </div>
        {% endif %}
        
        {% if my_newsletters %}
            <div class="col-lg-6 mb-4">
                <div class="custom-card h-100">
                    <div class="card-body">
                        <h3 class="mb-4"><i class="bi bi-envelope"></i> My Recent Newsletters</h3>
                        <div class="list-group list-group-flush">
                            {% for newsletter in my_newsletters %}
                                <div class="list-group-item d-flex justify-content-between align-items-center border-0 px-0">
                                    <a href="{% url 'newsletter_detail' newsletter.id %}" class="text-decoration-none">{{ newsletter.title }}</a>
                                    <span class="badge bg-info badge-custom">
                                        {{ newsletter.get_article_count }} articles
                                    </span>
                                </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
            </div>
        {% endif %}
    </div>

{% else %}
    <!-- Reader Dashboard -->
    <div class="row">
        <div class="col-md-12 mb-4">
            <div class="custom-card">
                <div class="card-body text-center">
                    <h3><i class="bi bi-book"></i> Reader Dashboard</h3>
                    <p class="mb-4">Browse articles and newsletters that interest you!</p>
                    <a href="{% url 'browse_subscriptions' %}" class="btn btn-primary-custom btn-custom">
                        <i class="bi bi-bookmark-plus"></i> Browse Subscriptions
                    </a>
                </div>
            </div>
        </div>
    </div>
    
    <div class="row">
        {% if subscribed_publishers %}
            <div class="col-lg-6 mb-4">
                <div class="custom-card h-100">
                    <div class="card-body">
                        <h3 class="mb-4"><i class="bi bi-building"></i> Subscribed Publishers</h3>
                        <div class="list-group list-group-flush">
                            {% for publisher in subscribed_publishers %}
                                <div class="list-group-item border-0 px-0">
                                    <i class="bi bi-check2"></i> {{ publisher.name }}
                                </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
            </div>
        {% endif %}
        
        {% if subscribed_journalists %}
            <div class="col-lg-6 mb-4">
                <div class="custom-card h-100">
                    <div class="card-body">
                        <h3 class="mb-4"><i class="bi bi-people"></i> Subscribed Journalists</h3>
                        <div class="list-group list-group-flush">
                            {% for journalist in subscribed_journalists %}
                                <div class="list-group-item border-0 px-0">
                                    <i class="bi bi-person-check"></i> {{ journalist.get_full_name|default:journalist.username }}
                                </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
            </div>
        {% endif %}
    </div>
    
    {% if recent_articles %}
        <div class="row">
            <div class="col-12">
                <div class="custom-card">
                    <div class="card-body">
                        <h3 class="mb-4"><i class="bi bi-newspaper"></i> Recent Articles</h3>
                        <div class="list-group list-group-flush">
                            {% for article in recent_articles %}
                                <div class="list-group-item border-0 px-0">
                                    <a href="{% url 'article_detail' article.id %}" class="text-decoration-none">{{ article.title }}</a>
                                </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    {% endif %}
{% endif %}
{% endblock %}
